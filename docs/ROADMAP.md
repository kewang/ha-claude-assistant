# HA Claude Assistant Roadmap

## Phase 1 - 核心強化（近期）

### 1. 更多 MCP Tools

- `get_history` — 查詢 HA 歷史資料（如「客廳溫度過去 24 小時變化」）
- `get_areas` — 列出區域/樓層，支援「關掉客廳所有燈」
- `get_logbook` — 查詢 HA 操作紀錄
- `get_diagnostics` — 系統健康檢查（CPU、記憶體、HA 版本）

### 2. 排程功能增強

- 排程執行歷史紀錄（成功/失敗、執行結果）
- 條件式排程（如「只在溫度超過 28°C 時開冷氣」）
- 排程模板（常用排程快速套用）

### 3. 區域/群組控制

- 支援 HA area 概念，批次操作整個區域的裝置
- 群組指令，如「把所有燈關掉」、「客廳進入電影模式」

## Phase 2 - 使用體驗提升（中期）

### 4. Slack Bot 互動強化

- Block Kit UI — 按鈕式裝置控制（開/關燈不用打字）
- 快捷動作按鈕（常用指令一鍵觸發）
- 裝置狀態異常推播通知（如感測器離線、門未關）
- Rich message 格式（溫濕度報告用卡片呈現）

### 5. 對話記憶進階

- 跨 session 長期記憶（記住使用者偏好、裝置暱稱）
- 對話摘要（長對話自動濃縮）
- 使用者偏好學習（常用裝置、習慣模式）

### 6. 自然語言自動化建立

- 用自然語言建立 HA automation：「每天日落時自動開玄關燈」
- 用對話建立多步驟情境：「電影模式 = 客廳燈調暗 + 開投影機」
- 條件邏輯支援：「如果沒人在家就關掉所有燈」

## Phase 3 - 進階功能（中長期）

### 7. WebSocket 即時事件

- 連接 HA WebSocket API，即時監聽狀態變化
- 狀態觸發通知（如「有人按門鈴」即時推送 Slack）
- 即時能源監控

### 8. 能源管理

- 用電量查詢與報告
- 電費估算
- 用電建議（離峰時段排程高耗電設備）
- 每日/每週/每月能源報告

### 9. 監控與分析

- 使用量統計（最常控制的裝置、最常用的指令）
- 錯誤率追蹤與趨勢
- 回應時間監控
- 簡易 dashboard（透過 Web UI 呈現）

## Phase 4 - 擴展生態（長期）

### 10. 多平台支援

- Telegram Bot 介面
- Discord Bot 介面
- LINE Bot 介面
- Web Chat 介面（獨立於 HA Ingress）

### 11. 多 HA 實例支援

- 同時管理多個 Home Assistant（如家裡 + 辦公室）
- 跨實例操作（「辦公室冷氣開了嗎？」）

### 12. 進階安全性

- 操作審計紀錄（誰在什麼時候做了什麼）
- 角色權限控制（某些裝置限制操作）
- 敏感操作二次確認（如開大門鎖）

## 持續改善

### 測試與品質

- 補充整合測試（模擬完整 flow）
- 加入 GitHub Actions CI/CD
- Mock HA Server 用於測試

### 開發體驗

- 抽取 Claude CLI 執行邏輯，減少 CLI/Slack/Scheduler 間的重複
- 依賴注入改善可測試性
- 統一 timeout 設定（目前散落各處）

## 優先順序建議

| 優先度 | 功能 | 理由 |
|--------|------|------|
| **高** | 歷史查詢 tool | 最常被問到的功能，實作簡單 |
| **高** | 區域控制 | 大幅提升日常使用體驗 |
| **高** | 排程執行歷史 | 排程跑了沒？結果是什麼？目前無從得知 |
| **中** | Slack 互動按鈕 | 降低使用門檻，不用記指令 |
| **中** | 自然語言建自動化 | Claude 的強項，差異化功能 |
| **中** | 能源管理 | 實用且有持續需求 |
| **低** | WebSocket 即時事件 | 架構改動較大，但能解鎖很多進階場景 |
| **低** | 多平台 | 需求視使用者群決定 |
